# .lefthook.yml

pre-commit:
  commands:
    biome-format:
      glob: "*.{js,ts,cjs,mjs,d.cts,d.mts,json,jsonc,jsx,tsx}"
      # Format only staged files
      run: pnpm format --files-ignore-unknown=true --no-errors-on-unmatched {staged_files}

    biome-lint:
      glob: "*.{js,ts,cjs,mjs,d.cts,d.mts,json,jsonc,jsx,tsx}"
      # Lint only staged files
      run: pnpm lint --files-ignore-unknown=true --no-errors-on-unmatched {staged_files}

commit-msg:
  commands:
    branch-name:
      run: |
        BRANCH_NAME="$(git rev-parse --abbrev-ref HEAD)"
        if ! echo "$BRANCH_NAME" | grep -Eq '^(main|development|staging|feature/.+|bugfix/.+|hotfix/.+)$'; then
          echo "‚ùå Invalid branch name: '$BRANCH_NAME'"
          echo "Branches must start with one of: main, development, staging, feature/<name>, bugfix/<name>, hotfix/<name>"
          exit 1
        fi

    lint:
      run: pnpm exec commitlint --edit {1}

pre-push:
  commands:
    biome-ci:
      glob: "*.{js,ts,cjs,mjs,d.cts,d.mts,jsx,tsx,json,jsonc}"
      run: pnpm exec biome ci . --no-errors-on-unmatched --files-ignore-unknown=true

    # Uncomment the following lines to enable tests on pre-push
    # test:
    #   run: pnpm turbo run test --filter=* # run tests in all packages

    typecheck:
      run: pnpm turbo run build --filter=*
